/*! For license information please see 186.76b8c85d.chunk.js.LICENSE.txt */
"use strict";(globalThis.webpackChunkbike_bus=globalThis.webpackChunkbike_bus||[]).push([[186],{1186:(e,t,o)=>{o.r(t),o.d(t,{startInputShims:()=>y});var n=o(4136),i=o(3743),r=o(1811),s=o(5573);const a=new WeakMap,d=function(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];a.has(e)!==o&&(o?l(e,t,n,i):c(e,t))},l=function(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=t.parentNode,r=t.cloneNode(!1);r.classList.add("cloned-input"),r.tabIndex=-1,n&&(r.disabled=!0),i.appendChild(r),a.set(e,r);const s="rtl"===e.ownerDocument.dir?9999:-9999;e.style.pointerEvents="none",t.style.transform=`translate3d(${s}px,${o}px,0) scale(0)`},c=(e,t)=>{const o=a.get(e);o&&(a.delete(e),o.remove()),e.style.pointerEvents="",t.style.transform=""},u="input, textarea, [no-blur], [contenteditable]",v=(e,t,o,n)=>{const i=e.top,r=e.bottom,s=t.top,a=s+15,d=Math.min(t.bottom,n-o)-50-r,l=a-i,c=Math.round(d<0?-d:l>0?-l:0),u=Math.min(c,i-s),v=Math.abs(u)/.3;return{scrollAmount:u,scrollDuration:Math.min(400,Math.max(150,v)),scrollPadding:o,inputSafeY:4-(i-a)}},w="$ionPaddingTimer",m=(e,t,o)=>{const n=e[w];n&&clearTimeout(n),t>0?e.style.setProperty("--keyboard-offset",`${t}px`):e[w]=setTimeout((()=>{e.style.setProperty("--keyboard-offset","0px"),o&&o()}),120)},h=(e,t,o)=>{e.addEventListener("focusout",(()=>{t&&m(t,0,o)}),{once:!0})};let f=0;const b="data-ionic-skip-scroll-assist",p=e=>{document.activeElement!==e&&(e.setAttribute(b,"true"),e.focus())},g=async function(e,t,o,n,s,a){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(!o&&!n)return;const u=((e,t,o,n)=>{var i;const r=null!==(i=e.closest("ion-item,[ion-item]"))&&void 0!==i?i:e;return v(r.getBoundingClientRect(),t.getBoundingClientRect(),o,n)})(e,o||n,s,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0);if(o&&Math.abs(u.scrollAmount)<4)return p(t),void(a&&null!==o&&(m(o,f),h(t,o,(()=>f=0))));if(d(e,t,!0,u.inputSafeY,l),p(t),(0,r.r)((()=>e.click())),a&&o&&(f=u.scrollPadding,m(o,f)),"undefined"!==typeof window){let n;const r=async()=>{void 0!==n&&clearTimeout(n),window.removeEventListener("ionKeyboardDidShow",s),window.removeEventListener("ionKeyboardDidShow",r),o&&await(0,i.c)(o,0,u.scrollAmount,u.scrollDuration),d(e,t,!1,u.inputSafeY),p(t),a&&h(t,o,(()=>f=0))},s=()=>{window.removeEventListener("ionKeyboardDidShow",s),window.addEventListener("ionKeyboardDidShow",r)};if(o){const e=await(0,i.g)(o),a=e.scrollHeight-e.clientHeight;if(c&&u.scrollAmount>a-e.scrollTop)return"password"===t.type?(u.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",s)):window.addEventListener("ionKeyboardDidShow",r),void(n=setTimeout(r,1e3))}r()}},y=async(e,t)=>{if(void 0===n.d)return;const o="ios"===t,a="android"===t,l=e.getNumber("keyboardHeight",290),c=e.getBoolean("scrollAssist",!0),v=e.getBoolean("hideCaretOnScroll",o),w=e.getBoolean("inputBlurring",o),m=e.getBoolean("scrollPadding",!0),h=Array.from(n.d.querySelectorAll("ion-input, ion-textarea")),f=new WeakMap,p=new WeakMap,y=await s.K.getResizeMode(),E=async e=>{await new Promise((t=>(0,r.c)(e,t)));const t=e.shadowRoot||e,o=t.querySelector("input")||t.querySelector("textarea"),u=(0,i.a)(e),w=u?null:e.closest("ion-footer");if(!o)return;if(u&&v&&!f.has(e)){const t=((e,t,o)=>{if(!o||!t)return()=>{};const n=o=>{var n;(n=t)===n.getRootNode().activeElement&&d(e,t,o)},i=()=>d(e,t,!1),s=()=>n(!0),a=()=>n(!1);return(0,r.a)(o,"ionScrollStart",s),(0,r.a)(o,"ionScrollEnd",a),t.addEventListener("blur",i),()=>{(0,r.b)(o,"ionScrollStart",s),(0,r.b)(o,"ionScrollEnd",a),t.removeEventListener("blur",i)}})(e,o,u);f.set(e,t)}if(!("date"===o.type||"datetime-local"===o.type)&&(u||w)&&c&&!p.has(e)){const t=function(e,t,o,i,r,a,d){let l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const c=a&&(void 0===d||d.mode===s.a.None);let u=!1;const v=void 0!==n.w?n.w.innerHeight:0,w=n=>{!1!==u?g(e,t,o,i,n.detail.keyboardHeight,c,l,v,!1):u=!0},m=()=>{u=!1,null===n.w||void 0===n.w||n.w.removeEventListener("ionKeyboardDidShow",w),e.removeEventListener("focusout",m,!0)},h=async()=>{t.hasAttribute(b)?t.removeAttribute(b):(g(e,t,o,i,r,c,l,v),null===n.w||void 0===n.w||n.w.addEventListener("ionKeyboardDidShow",w),e.addEventListener("focusout",m,!0))};return e.addEventListener("focusin",h,!0),()=>{e.removeEventListener("focusin",h,!0),null===n.w||void 0===n.w||n.w.removeEventListener("ionKeyboardDidShow",w),e.removeEventListener("focusout",m,!0)}}(e,o,u,w,l,m,y,a);p.set(e,t)}};w&&(()=>{let e=!0,t=!1;const o=document,n=()=>{t=!0},i=()=>{e=!0},s=n=>{if(t)return void(t=!1);const i=o.activeElement;if(!i)return;if(i.matches(u))return;const r=n.target;r!==i&&(r.matches(u)||r.closest(u)||(e=!1,setTimeout((()=>{e||i.blur()}),50)))};(0,r.a)(o,"ionScrollStart",n),o.addEventListener("focusin",i,!0),o.addEventListener("touchend",s,!1)})();for(const n of h)E(n);n.d.addEventListener("ionInputDidLoad",(e=>{E(e.detail)})),n.d.addEventListener("ionInputDidUnload",(e=>{(e=>{if(v){const t=f.get(e);t&&t(),f.delete(e)}if(c){const t=p.get(e);t&&t(),p.delete(e)}})(e.detail)}))}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YTVGLElBQUk1QixHQUN4QndLLEdBQ0FBLElBRUpoRCxFQUFhM0YsT0FBTzdCLEVBQ3hCLENBQ0EsR0FBSWdILEVBQWMsQ0FDZCxNQUFNd0QsRUFBSy9DLEVBQWdCN0YsSUFBSTVCLEdBQzNCd0ssR0FDQUEsSUFFSi9DLEVBQWdCNUYsT0FBTzdCLEVBQzNCLEdBZUF5SyxDQUFnQm5CLEVBQUdDLE9BQU8sR0FDNUIiLCJzb3VyY2VzIjpbIi4uL25vZGVfbW9kdWxlcy9AaW9uaWMvY29yZS9jb21wb25lbnRzL2lucHV0LXNoaW1zLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogKEMpIElvbmljIGh0dHA6Ly9pb25pY2ZyYW1ld29yay5jb20gLSBNSVQgTGljZW5zZVxuICovXG5pbXBvcnQgeyB3IGFzIHdpbiwgZCBhcyBkb2MgfSBmcm9tICcuL2luZGV4NS5qcyc7XG5pbXBvcnQgeyBnIGFzIGdldFNjcm9sbEVsZW1lbnQsIGMgYXMgc2Nyb2xsQnlQb2ludCwgYSBhcyBmaW5kQ2xvc2VzdElvbkNvbnRlbnQgfSBmcm9tICcuL2luZGV4OC5qcyc7XG5pbXBvcnQgeyBhIGFzIGFkZEV2ZW50TGlzdGVuZXIsIGIgYXMgcmVtb3ZlRXZlbnRMaXN0ZW5lciwgciBhcyByYWYsIGMgYXMgY29tcG9uZW50T25SZWFkeSB9IGZyb20gJy4vaGVscGVycy5qcyc7XG5pbXBvcnQgeyBhIGFzIEtleWJvYXJkUmVzaXplLCBLIGFzIEtleWJvYXJkIH0gZnJvbSAnLi9rZXlib2FyZC5qcyc7XG5cbmNvbnN0IGNsb25lTWFwID0gbmV3IFdlYWtNYXAoKTtcbmNvbnN0IHJlbG9jYXRlSW5wdXQgPSAoY29tcG9uZW50RWwsIGlucHV0RWwsIHNob3VsZFJlbG9jYXRlLCBpbnB1dFJlbGF0aXZlWSA9IDAsIGRpc2FibGVkQ2xvbmVkSW5wdXQgPSBmYWxzZSkgPT4ge1xuICAgIGlmIChjbG9uZU1hcC5oYXMoY29tcG9uZW50RWwpID09PSBzaG91bGRSZWxvY2F0ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChzaG91bGRSZWxvY2F0ZSkge1xuICAgICAgICBhZGRDbG9uZShjb21wb25lbnRFbCwgaW5wdXRFbCwgaW5wdXRSZWxhdGl2ZVksIGRpc2FibGVkQ2xvbmVkSW5wdXQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVtb3ZlQ2xvbmUoY29tcG9uZW50RWwsIGlucHV0RWwpO1xuICAgIH1cbn07XG5jb25zdCBpc0ZvY3VzZWQgPSAoaW5wdXQpID0+IHtcbiAgICAvKipcbiAgICAgKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvTm9kZS9nZXRSb290Tm9kZVxuICAgICAqIENhbGxpbmcgZ2V0Um9vdE5vZGUgb24gYW4gZWxlbWVudCBpbiBzdGFuZGFyZCB3ZWIgcGFnZSB3aWxsIHJldHVybiBIVE1MRG9jdW1lbnQuXG4gICAgICogQ2FsbGluZyBnZXRSb290Tm9kZSBvbiBhbiBlbGVtZW50IGluc2lkZSBvZiB0aGUgU2hhZG93IERPTSB3aWxsIHJldHVybiB0aGUgYXNzb2NpYXRlZCBTaGFkb3dSb290LlxuICAgICAqIENhbGxpbmcgZ2V0Um9vdE5vZGUgb24gYW4gZWxlbWVudCB0aGF0IGlzIG5vdCBhdHRhY2hlZCB0byBhIGRvY3VtZW50L3NoYWRvdyB0cmVlIHdpbGwgcmV0dXJuXG4gICAgICogdGhlIHJvb3Qgb2YgdGhlIERPTSB0cmVlIGl0IGJlbG9uZ3MgdG8uXG4gICAgICogaXNGb2N1c2VkIGlzIHVzZWQgZm9yIHRoZSBoaWRlLWNhcmV0IHV0aWxpdHkgd2hpY2ggb25seSBjb25zaWRlcnMgaW5wdXQvdGV4dGFyZWEgZWxlbWVudHNcbiAgICAgKiB0aGF0IGFyZSBwcmVzZW50IGluIHRoZSBET00sIHNvIHdlIGRvbid0IHNldCB0eXBlcyBmb3IgdGhhdCBmaW5hbCBjYXNlIHNpbmNlIGl0IGRvZXMgbm90IGFwcGx5LlxuICAgICAqL1xuICAgIHJldHVybiBpbnB1dCA9PT0gaW5wdXQuZ2V0Um9vdE5vZGUoKS5hY3RpdmVFbGVtZW50O1xufTtcbmNvbnN0IGFkZENsb25lID0gKGNvbXBvbmVudEVsLCBpbnB1dEVsLCBpbnB1dFJlbGF0aXZlWSwgZGlzYWJsZWRDbG9uZWRJbnB1dCA9IGZhbHNlKSA9PiB7XG4gICAgLy8gdGhpcyBhbGxvd3MgZm9yIHRoZSBhY3R1YWwgaW5wdXQgdG8gcmVjZWl2ZSB0aGUgZm9jdXMgZnJvbVxuICAgIC8vIHRoZSB1c2VyJ3MgdG91Y2ggZXZlbnQsIGJ1dCBiZWZvcmUgaXQgcmVjZWl2ZXMgZm9jdXMsIGl0XG4gICAgLy8gbW92ZXMgdGhlIGFjdHVhbCBpbnB1dCB0byBhIGxvY2F0aW9uIHRoYXQgd2lsbCBub3Qgc2NyZXdcbiAgICAvLyB1cCB0aGUgYXBwJ3MgbGF5b3V0LCBhbmQgZG9lcyBub3QgYWxsb3cgdGhlIG5hdGl2ZSBicm93c2VyXG4gICAgLy8gdG8gYXR0ZW1wdCB0byBzY3JvbGwgdGhlIGlucHV0IGludG8gcGxhY2UgKG1lc3NpbmcgdXAgaGVhZGVycy9mb290ZXJzKVxuICAgIC8vIHRoZSBjbG9uZWQgaW5wdXQgZmlsbHMgdGhlIGFyZWEgb2Ygd2hlcmUgbmF0aXZlIGlucHV0IHNob3VsZCBiZVxuICAgIC8vIHdoaWxlIHRoZSBuYXRpdmUgaW5wdXQgZmFrZXMgb3V0IHRoZSBicm93c2VyIGJ5IHJlbG9jYXRpbmcgaXRzZWxmXG4gICAgLy8gYmVmb3JlIGl0IHJlY2VpdmVzIHRoZSBhY3R1YWwgZm9jdXMgZXZlbnRcbiAgICAvLyBXZSBoaWRlIHRoZSBmb2N1c2VkIGlucHV0ICh3aXRoIHRoZSB2aXNpYmxlIGNhcmV0KSBpbnZpc2libGUgYnkgbWFraW5nIGl0IHNjYWxlKDApLFxuICAgIGNvbnN0IHBhcmVudEVsID0gaW5wdXRFbC5wYXJlbnROb2RlO1xuICAgIC8vIERPTSBXUklURVNcbiAgICBjb25zdCBjbG9uZWRFbCA9IGlucHV0RWwuY2xvbmVOb2RlKGZhbHNlKTtcbiAgICBjbG9uZWRFbC5jbGFzc0xpc3QuYWRkKCdjbG9uZWQtaW5wdXQnKTtcbiAgICBjbG9uZWRFbC50YWJJbmRleCA9IC0xO1xuICAgIC8qKlxuICAgICAqIE1ha2luZyB0aGUgY2xvbmVkIGlucHV0IGRpc2FibGVkIHByZXZlbnRzXG4gICAgICogQ2hyb21lIGZvciBBbmRyb2lkIGZyb20gc3RpbGwgc2Nyb2xsaW5nXG4gICAgICogdGhlIGVudGlyZSBwYWdlIHNpbmNlIHRoaXMgY2xvbmVkIGlucHV0XG4gICAgICogd2lsbCBicmllZmx5IGJlIGhpZGRlbiBieSB0aGUga2V5Ym9hcmRcbiAgICAgKiBldmVuIHRob3VnaCBpdCBpcyBub3QgZm9jdXNlZC5cbiAgICAgKlxuICAgICAqIFRoaXMgaXMgbm90IG5lZWRlZCBvbiBpT1MuIFdoaWxlIHRoaXNcbiAgICAgKiBkb2VzIG5vdCBjYXVzZSBmdW5jdGlvbmFsIGlzc3VlcyBvbiBpT1MsXG4gICAgICogdGhlIGlucHV0IHN0aWxsIGFwcGVhcnMgc2xpZ2h0bHkgZGltbWVkIGV2ZW5cbiAgICAgKiBpZiB3ZSBzZXQgb3BhY2l0eTogMS5cbiAgICAgKi9cbiAgICBpZiAoZGlzYWJsZWRDbG9uZWRJbnB1dCkge1xuICAgICAgICBjbG9uZWRFbC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfVxuICAgIHBhcmVudEVsLmFwcGVuZENoaWxkKGNsb25lZEVsKTtcbiAgICBjbG9uZU1hcC5zZXQoY29tcG9uZW50RWwsIGNsb25lZEVsKTtcbiAgICBjb25zdCBkb2MgPSBjb21wb25lbnRFbC5vd25lckRvY3VtZW50O1xuICAgIGNvbnN0IHR4ID0gZG9jLmRpciA9PT0gJ3J0bCcgPyA5OTk5IDogLTk5OTk7XG4gICAgY29tcG9uZW50RWwuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJztcbiAgICBpbnB1dEVsLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUzZCgke3R4fXB4LCR7aW5wdXRSZWxhdGl2ZVl9cHgsMCkgc2NhbGUoMClgO1xufTtcbmNvbnN0IHJlbW92ZUNsb25lID0gKGNvbXBvbmVudEVsLCBpbnB1dEVsKSA9PiB7XG4gICAgY29uc3QgY2xvbmUgPSBjbG9uZU1hcC5nZXQoY29tcG9uZW50RWwpO1xuICAgIGlmIChjbG9uZSkge1xuICAgICAgICBjbG9uZU1hcC5kZWxldGUoY29tcG9uZW50RWwpO1xuICAgICAgICBjbG9uZS5yZW1vdmUoKTtcbiAgICB9XG4gICAgY29tcG9uZW50RWwuc3R5bGUucG9pbnRlckV2ZW50cyA9ICcnO1xuICAgIGlucHV0RWwuc3R5bGUudHJhbnNmb3JtID0gJyc7XG59O1xuLyoqXG4gKiBGYWN0b3JpbmcgaW4gNTBweCBnaXZlcyB1cyBzb21lIHJvb21cbiAqIGluIGNhc2UgdGhlIGtleWJvYXJkIHNob3dzIHBhc3N3b3JkL2F1dG9maWxsIGJhcnNcbiAqIGFzeW5jaHJvbm91c2x5LlxuICovXG5jb25zdCBTQ1JPTExfQU1PVU5UX1BBRERJTkcgPSA1MDtcblxuY29uc3QgZW5hYmxlSGlkZUNhcmV0T25TY3JvbGwgPSAoY29tcG9uZW50RWwsIGlucHV0RWwsIHNjcm9sbEVsKSA9PiB7XG4gICAgaWYgKCFzY3JvbGxFbCB8fCAhaW5wdXRFbCkge1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBzY3JvbGxIaWRlQ2FyZXQgPSAoc2hvdWxkSGlkZUNhcmV0KSA9PiB7XG4gICAgICAgIGlmIChpc0ZvY3VzZWQoaW5wdXRFbCkpIHtcbiAgICAgICAgICAgIHJlbG9jYXRlSW5wdXQoY29tcG9uZW50RWwsIGlucHV0RWwsIHNob3VsZEhpZGVDYXJldCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IG9uQmx1ciA9ICgpID0+IHJlbG9jYXRlSW5wdXQoY29tcG9uZW50RWwsIGlucHV0RWwsIGZhbHNlKTtcbiAgICBjb25zdCBoaWRlQ2FyZXQgPSAoKSA9PiBzY3JvbGxIaWRlQ2FyZXQodHJ1ZSk7XG4gICAgY29uc3Qgc2hvd0NhcmV0ID0gKCkgPT4gc2Nyb2xsSGlkZUNhcmV0KGZhbHNlKTtcbiAgICBhZGRFdmVudExpc3RlbmVyKHNjcm9sbEVsLCAnaW9uU2Nyb2xsU3RhcnQnLCBoaWRlQ2FyZXQpO1xuICAgIGFkZEV2ZW50TGlzdGVuZXIoc2Nyb2xsRWwsICdpb25TY3JvbGxFbmQnLCBzaG93Q2FyZXQpO1xuICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIG9uQmx1cik7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcihzY3JvbGxFbCwgJ2lvblNjcm9sbFN0YXJ0JywgaGlkZUNhcmV0KTtcbiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcihzY3JvbGxFbCwgJ2lvblNjcm9sbEVuZCcsIHNob3dDYXJldCk7XG4gICAgICAgIGlucHV0RWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIG9uQmx1cik7XG4gICAgfTtcbn07XG5cbmNvbnN0IFNLSVBfU0VMRUNUT1IgPSAnaW5wdXQsIHRleHRhcmVhLCBbbm8tYmx1cl0sIFtjb250ZW50ZWRpdGFibGVdJztcbmNvbnN0IGVuYWJsZUlucHV0Qmx1cnJpbmcgPSAoKSA9PiB7XG4gICAgbGV0IGZvY3VzZWQgPSB0cnVlO1xuICAgIGxldCBkaWRTY3JvbGwgPSBmYWxzZTtcbiAgICBjb25zdCBkb2MgPSBkb2N1bWVudDtcbiAgICBjb25zdCBvblNjcm9sbCA9ICgpID0+IHtcbiAgICAgICAgZGlkU2Nyb2xsID0gdHJ1ZTtcbiAgICB9O1xuICAgIGNvbnN0IG9uRm9jdXNpbiA9ICgpID0+IHtcbiAgICAgICAgZm9jdXNlZCA9IHRydWU7XG4gICAgfTtcbiAgICBjb25zdCBvblRvdWNoZW5kID0gKGV2KSA9PiB7XG4gICAgICAgIC8vIGlmIGFwcCBkaWQgc2Nyb2xsIHJldHVybiBlYXJseVxuICAgICAgICBpZiAoZGlkU2Nyb2xsKSB7XG4gICAgICAgICAgICBkaWRTY3JvbGwgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhY3RpdmUgPSBkb2MuYWN0aXZlRWxlbWVudDtcbiAgICAgICAgaWYgKCFhY3RpdmUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBvbmx5IGJsdXIgaWYgdGhlIGFjdGl2ZSBlbGVtZW50IGlzIGEgdGV4dC1pbnB1dCBvciBhIHRleHRhcmVhXG4gICAgICAgIGlmIChhY3RpdmUubWF0Y2hlcyhTS0lQX1NFTEVDVE9SKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIHRoZSBzZWxlY3RlZCB0YXJnZXQgaXMgdGhlIGFjdGl2ZSBlbGVtZW50LCBkbyBub3QgYmx1clxuICAgICAgICBjb25zdCB0YXBwZWQgPSBldi50YXJnZXQ7XG4gICAgICAgIGlmICh0YXBwZWQgPT09IGFjdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0YXBwZWQubWF0Y2hlcyhTS0lQX1NFTEVDVE9SKSB8fCB0YXBwZWQuY2xvc2VzdChTS0lQX1NFTEVDVE9SKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgLy8gVE9ETyBGVy0yNzk2OiBmaW5kIGEgYmV0dGVyIHdheSwgd2h5IDUwbXM/XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFmb2N1c2VkKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZlLmJsdXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgNTApO1xuICAgIH07XG4gICAgYWRkRXZlbnRMaXN0ZW5lcihkb2MsICdpb25TY3JvbGxTdGFydCcsIG9uU2Nyb2xsKTtcbiAgICBkb2MuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNpbicsIG9uRm9jdXNpbiwgdHJ1ZSk7XG4gICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgb25Ub3VjaGVuZCwgZmFsc2UpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIoZG9jLCAnaW9uU2Nyb2xsU3RhcnQnLCBvblNjcm9sbCwgdHJ1ZSk7XG4gICAgICAgIGRvYy5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1c2luJywgb25Gb2N1c2luLCB0cnVlKTtcbiAgICAgICAgZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgb25Ub3VjaGVuZCwgZmFsc2UpO1xuICAgIH07XG59O1xuXG5jb25zdCBTQ1JPTExfQVNTSVNUX1NQRUVEID0gMC4zO1xuY29uc3QgZ2V0U2Nyb2xsRGF0YSA9IChjb21wb25lbnRFbCwgY29udGVudEVsLCBrZXlib2FyZEhlaWdodCwgcGxhdGZvcm1IZWlnaHQpID0+IHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgaXRlbUVsID0gKF9hID0gY29tcG9uZW50RWwuY2xvc2VzdCgnaW9uLWl0ZW0sW2lvbi1pdGVtXScpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBjb21wb25lbnRFbDtcbiAgICByZXR1cm4gY2FsY1Njcm9sbERhdGEoaXRlbUVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCBjb250ZW50RWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIGtleWJvYXJkSGVpZ2h0LCBwbGF0Zm9ybUhlaWdodCk7XG59O1xuY29uc3QgY2FsY1Njcm9sbERhdGEgPSAoaW5wdXRSZWN0LCBjb250ZW50UmVjdCwga2V5Ym9hcmRIZWlnaHQsIHBsYXRmb3JtSGVpZ2h0KSA9PiB7XG4gICAgLy8gY29tcHV0ZSBpbnB1dCdzIFkgdmFsdWVzIHJlbGF0aXZlIHRvIHRoZSBib2R5XG4gICAgY29uc3QgaW5wdXRUb3AgPSBpbnB1dFJlY3QudG9wO1xuICAgIGNvbnN0IGlucHV0Qm90dG9tID0gaW5wdXRSZWN0LmJvdHRvbTtcbiAgICAvLyBjb21wdXRlIHZpc2libGUgYXJlYVxuICAgIGNvbnN0IHZpc2libGVBcmVhVG9wID0gY29udGVudFJlY3QudG9wO1xuICAgIGNvbnN0IHZpc2libGVBcmVhQm90dG9tID0gTWF0aC5taW4oY29udGVudFJlY3QuYm90dG9tLCBwbGF0Zm9ybUhlaWdodCAtIGtleWJvYXJkSGVpZ2h0KTtcbiAgICAvLyBjb21wdXRlIHNhZmUgYXJlYVxuICAgIGNvbnN0IHNhZmVBcmVhVG9wID0gdmlzaWJsZUFyZWFUb3AgKyAxNTtcbiAgICBjb25zdCBzYWZlQXJlYUJvdHRvbSA9IHZpc2libGVBcmVhQm90dG9tIC0gU0NST0xMX0FNT1VOVF9QQURESU5HO1xuICAgIC8vIGZpZ3VyZSBvdXQgaWYgZWFjaCBlZGdlIG9mIHRoZSBpbnB1dCBpcyB3aXRoaW4gdGhlIHNhZmUgYXJlYVxuICAgIGNvbnN0IGRpc3RhbmNlVG9Cb3R0b20gPSBzYWZlQXJlYUJvdHRvbSAtIGlucHV0Qm90dG9tO1xuICAgIGNvbnN0IGRpc3RhbmNlVG9Ub3AgPSBzYWZlQXJlYVRvcCAtIGlucHV0VG9wO1xuICAgIC8vIGRlc2lyZWRTY3JvbGxBbW91bnQgaXMgdGhlIG5lZ2F0ZWQgZGlzdGFuY2UgdG8gdGhlIHNhZmUgYXJlYSBhY2NvcmRpbmcgdG8gb3VyIGNhbGN1bGF0aW9ucy5cbiAgICBjb25zdCBkZXNpcmVkU2Nyb2xsQW1vdW50ID0gTWF0aC5yb3VuZChkaXN0YW5jZVRvQm90dG9tIDwgMCA/IC1kaXN0YW5jZVRvQm90dG9tIDogZGlzdGFuY2VUb1RvcCA+IDAgPyAtZGlzdGFuY2VUb1RvcCA6IDApO1xuICAgIC8vIG91ciBjYWxjdWxhdGlvbnMgbWFrZSBzb21lIGFzc3VtcHRpb25zIHRoYXQgYXJlbid0IGFsd2F5cyB0cnVlLCBsaWtlIHRoZSBrZXlib2FyZCBiZWluZyBjbG9zZWQgd2hlbiBhbiBpbnB1dFxuICAgIC8vIGdldHMgZm9jdXMsIHNvIG1ha2Ugc3VyZSB3ZSBkb24ndCBzY3JvbGwgdGhlIGlucHV0IGFib3ZlIHRoZSB2aXNpYmxlIGFyZWFcbiAgICBjb25zdCBzY3JvbGxBbW91bnQgPSBNYXRoLm1pbihkZXNpcmVkU2Nyb2xsQW1vdW50LCBpbnB1dFRvcCAtIHZpc2libGVBcmVhVG9wKTtcbiAgICBjb25zdCBkaXN0YW5jZSA9IE1hdGguYWJzKHNjcm9sbEFtb3VudCk7XG4gICAgY29uc3QgZHVyYXRpb24gPSBkaXN0YW5jZSAvIFNDUk9MTF9BU1NJU1RfU1BFRUQ7XG4gICAgY29uc3Qgc2Nyb2xsRHVyYXRpb24gPSBNYXRoLm1pbig0MDAsIE1hdGgubWF4KDE1MCwgZHVyYXRpb24pKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBzY3JvbGxBbW91bnQsXG4gICAgICAgIHNjcm9sbER1cmF0aW9uLFxuICAgICAgICBzY3JvbGxQYWRkaW5nOiBrZXlib2FyZEhlaWdodCxcbiAgICAgICAgaW5wdXRTYWZlWTogLShpbnB1dFRvcCAtIHNhZmVBcmVhVG9wKSArIDQsXG4gICAgfTtcbn07XG5cbmNvbnN0IFBBRERJTkdfVElNRVJfS0VZID0gJyRpb25QYWRkaW5nVGltZXInO1xuLyoqXG4gKiBTY3JvbGwgcGFkZGluZyBhZGRzIGFkZGl0aW9uYWwgcGFkZGluZyB0byB0aGUgYm90dG9tXG4gKiBvZiBpb24tY29udGVudCBzbyB0aGF0IHRoZXJlIGlzIGVub3VnaCBzY3JvbGwgc3BhY2VcbiAqIGZvciBhbiBpbnB1dCB0byBiZSBzY3JvbGxlZCBhYm92ZSB0aGUga2V5Ym9hcmQuIFRoaXNcbiAqIGlzIG5lZWRlZCBpbiBlbnZpcm9ubWVudHMgd2hlcmUgdGhlIHdlYnZpZXcgZG9lcyBub3RcbiAqIHJlc2l6ZSB3aGVuIHRoZSBrZXlib2FyZCBvcGVucy5cbiAqXG4gKiBFeGFtcGxlOiBJZiBhbiBpbnB1dCBhdCB0aGUgYm90dG9tIG9mIGlvbi1jb250ZW50IGlzXG4gKiBmb2N1c2VkLCB0aGVyZSBpcyBubyBhZGRpdGlvbmFsIHNjcm9sbGluZyBzcGFjZSBiZWxvd1xuICogaXQsIHNvIHRoZSBpbnB1dCBjYW5ub3QgYmUgc2Nyb2xsZWQgYWJvdmUgdGhlIGtleWJvYXJkLlxuICogU2Nyb2xsIHBhZGRpbmcgZml4ZXMgdGhpcyBieSBhZGRpbmcgcGFkZGluZyBlcXVhbCB0byB0aGVcbiAqIGhlaWdodCBvZiB0aGUga2V5Ym9hcmQgdG8gdGhlIGJvdHRvbSBvZiB0aGUgY29udGVudC5cbiAqXG4gKiBDb21tb24gZW52aXJvbm1lbnRzIHdoZXJlIHRoaXMgaXMgbmVlZGVkOlxuICogLSBNb2JpbGUgU2FmYXJpOiBUaGUga2V5Ym9hcmQgb3ZlcmxheXMgdGhlIGNvbnRlbnRcbiAqIC0gQ2FwYWNpdG9yL0NvcmRvdmEgb24gaU9TOiBUaGUga2V5Ym9hcmQgb3ZlcmxheXMgdGhlIGNvbnRlbnRcbiAqIHdoZW4gdGhlIEtleWJvYXJkUmVzaXplIG1vZGUgaXMgc2V0IHRvICdub25lJy5cbiAqL1xuY29uc3Qgc2V0U2Nyb2xsUGFkZGluZyA9IChjb250ZW50RWwsIHBhZGRpbmdBbW91bnQsIGNsZWFyQ2FsbGJhY2spID0+IHtcbiAgICBjb25zdCB0aW1lciA9IGNvbnRlbnRFbFtQQURESU5HX1RJTUVSX0tFWV07XG4gICAgaWYgKHRpbWVyKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgfVxuICAgIGlmIChwYWRkaW5nQW1vdW50ID4gMCkge1xuICAgICAgICBjb250ZW50RWwuc3R5bGUuc2V0UHJvcGVydHkoJy0ta2V5Ym9hcmQtb2Zmc2V0JywgYCR7cGFkZGluZ0Ftb3VudH1weGApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29udGVudEVsW1BBRERJTkdfVElNRVJfS0VZXSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgY29udGVudEVsLnN0eWxlLnNldFByb3BlcnR5KCctLWtleWJvYXJkLW9mZnNldCcsICcwcHgnKTtcbiAgICAgICAgICAgIGlmIChjbGVhckNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJDYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAxMjApO1xuICAgIH1cbn07XG4vKipcbiAqIFdoZW4gYW4gaW5wdXQgaXMgYWJvdXQgdG8gYmUgZm9jdXNlZCxcbiAqIHNldCBhIHRpbWVvdXQgdG8gY2xlYXIgYW55IHNjcm9sbCBwYWRkaW5nXG4gKiBvbiB0aGUgY29udGVudC4gTm90ZTogVGhlIGNsZWFyaW5nXG4gKiBpcyBkb25lIG9uIGEgdGltZW91dCBzbyB0aGF0IGlmIHVzZXJzXG4gKiBhcmUgbW92aW5nIGZvY3VzIGZyb20gb25lIGlucHV0IHRvIHRoZSBuZXh0XG4gKiB0aGVuIHJlLWFkZGluZyBzY3JvbGwgcGFkZGluZyB0byB0aGUgbmV3XG4gKiBpbnB1dCB3aXRoIGNhbmNlbCB0aGUgdGltZW91dCB0byBjbGVhciB0aGVcbiAqIHNjcm9sbCBwYWRkaW5nLlxuICovXG5jb25zdCBzZXRDbGVhclNjcm9sbFBhZGRpbmdMaXN0ZW5lciA9IChpbnB1dEVsLCBjb250ZW50RWwsIGRvbmVDYWxsYmFjaykgPT4ge1xuICAgIGNvbnN0IGNsZWFyU2Nyb2xsUGFkZGluZyA9ICgpID0+IHtcbiAgICAgICAgaWYgKGNvbnRlbnRFbCkge1xuICAgICAgICAgICAgc2V0U2Nyb2xsUGFkZGluZyhjb250ZW50RWwsIDAsIGRvbmVDYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNvdXQnLCBjbGVhclNjcm9sbFBhZGRpbmcsIHsgb25jZTogdHJ1ZSB9KTtcbn07XG5cbmxldCBjdXJyZW50UGFkZGluZyA9IDA7XG5jb25zdCBTS0lQX1NDUk9MTF9BU1NJU1QgPSAnZGF0YS1pb25pYy1za2lwLXNjcm9sbC1hc3Npc3QnO1xuY29uc3QgZW5hYmxlU2Nyb2xsQXNzaXN0ID0gKGNvbXBvbmVudEVsLCBpbnB1dEVsLCBjb250ZW50RWwsIGZvb3RlckVsLCBrZXlib2FyZEhlaWdodCwgZW5hYmxlU2Nyb2xsUGFkZGluZywga2V5Ym9hcmRSZXNpemUsIGRpc2FibGVDbG9uZWRJbnB1dCA9IGZhbHNlKSA9PiB7XG4gICAgLyoqXG4gICAgICogU2Nyb2xsIHBhZGRpbmcgc2hvdWxkIG9ubHkgYmUgYWRkZWQgaWY6XG4gICAgICogMS4gVGhlIGdsb2JhbCBzY3JvbGxQYWRkaW5nIGNvbmZpZyBvcHRpb25cbiAgICAgKiBpcyBzZXQgdG8gdHJ1ZS5cbiAgICAgKiAyLiBUaGUgbmF0aXZlIGtleWJvYXJkIHJlc2l6ZSBtb2RlIGlzIGVpdGhlciBcIm5vbmVcIlxuICAgICAqIChrZXlib2FyZCBvdmVybGF5cyB3ZWJ2aWV3KSBvciB1bmRlZmluZWQgKHJlc2l6ZVxuICAgICAqIGluZm9ybWF0aW9uIHVuYXZhaWxhYmxlKVxuICAgICAqIFJlc2l6ZSBpbmZvIGlzIGF2YWlsYWJsZSBvbiBDYXBhY2l0b3IgNCtcbiAgICAgKi9cbiAgICBjb25zdCBhZGRTY3JvbGxQYWRkaW5nID0gZW5hYmxlU2Nyb2xsUGFkZGluZyAmJiAoa2V5Ym9hcmRSZXNpemUgPT09IHVuZGVmaW5lZCB8fCBrZXlib2FyZFJlc2l6ZS5tb2RlID09PSBLZXlib2FyZFJlc2l6ZS5Ob25lKTtcbiAgICAvKipcbiAgICAgKiBUaGlzIHRyYWNrcyB3aGV0aGVyIG9yIG5vdCB0aGUga2V5Ym9hcmQgaGFzIGJlZW5cbiAgICAgKiBwcmVzZW50ZWQgZm9yIGEgc2luZ2xlIGZvY3VzZWQgdGV4dCBmaWVsZC4gTm90ZVxuICAgICAqIHRoYXQgaXQgZG9lcyBub3QgdHJhY2sgaWYgdGhlIGtleWJvYXJkIGlzIG9wZW5cbiAgICAgKiBpbiBnZW5lcmFsIHN1Y2ggYXMgaWYgdGhlIGtleWJvYXJkIGlzIG9wZW4gZm9yXG4gICAgICogYSBkaWZmZXJlbnQgZm9jdXNlZCB0ZXh0IGZpZWxkLlxuICAgICAqL1xuICAgIGxldCBoYXNLZXlib2FyZEJlZW5QcmVzZW50ZWRGb3JUZXh0RmllbGQgPSBmYWxzZTtcbiAgICAvKipcbiAgICAgKiBXaGVuIGFkZGluZyBzY3JvbGwgcGFkZGluZyB3ZSBuZWVkIHRvIGtub3dcbiAgICAgKiBob3cgbXVjaCBvZiB0aGUgdmlld3BvcnQgdGhlIGtleWJvYXJkIG9ic2N1cmVzLlxuICAgICAqIFdlIGRvIHRoaXMgYnkgc3VidHJhY3RpbmcgdGhlIGtleWJvYXJkIGhlaWdodFxuICAgICAqIGZyb20gdGhlIHBsYXRmb3JtIGhlaWdodC5cbiAgICAgKlxuICAgICAqIElmIHdlIGNvbXB1dGUgdGhpcyB2YWx1ZSB3aGVuIHN3aXRjaGluZyBiZXR3ZWVuXG4gICAgICogaW5wdXRzIHRoZW4gdGhlIHdlYnZpZXcgbWF5IGFscmVhZHkgYmUgcmVzaXplZC5cbiAgICAgKiBBdCB0aGlzIHBvaW50LCBgd2luLmlubmVySGVpZ2h0YCBoYXMgYWxyZWFkeSBhY2NvdW50ZWRcbiAgICAgKiBmb3IgdGhlIGtleWJvYXJkIG1lYW5pbmcgd2Ugd291bGQgdGhlbiBzdWJ0cmFjdFxuICAgICAqIHRoZSBrZXlib2FyZCBoZWlnaHQgYWdhaW4uIFRoaXMgd2lsbCByZXN1bHQgaW4gdGhlIGlucHV0XG4gICAgICogYmVpbmcgc2Nyb2xsZWQgbW9yZSB0aGFuIGl0IG5lZWRzIHRvLlxuICAgICAqL1xuICAgIGNvbnN0IHBsYXRmb3JtSGVpZ2h0ID0gd2luICE9PSB1bmRlZmluZWQgPyB3aW4uaW5uZXJIZWlnaHQgOiAwO1xuICAgIC8qKlxuICAgICAqIFNjcm9sbCBhc3Npc3QgaXMgcnVuIHdoZW4gYSB0ZXh0IGZpZWxkXG4gICAgICogaXMgZm9jdXNlZC4gSG93ZXZlciwgaXQgbWF5IG5lZWQgdG9cbiAgICAgKiByZS1ydW4gd2hlbiB0aGUga2V5Ym9hcmQgc2l6ZSBjaGFuZ2VzXG4gICAgICogc3VjaCB0aGF0IHRoZSB0ZXh0IGZpZWxkIGlzIG5vdyBoaWRkZW5cbiAgICAgKiB1bmRlcm5lYXRoIHRoZSBrZXlib2FyZC5cbiAgICAgKiBUaGlzIGZ1bmN0aW9uIHJlLXJ1bnMgc2Nyb2xsIGFzc2lzdFxuICAgICAqIHdoZW4gdGhhdCBoYXBwZW5zLlxuICAgICAqXG4gICAgICogT25lIGxpbWl0YXRpb24gb2YgdGhpcyBpcyBvbiBhIHdlYiBicm93c2VyXG4gICAgICogd2hlcmUgbmF0aXZlIGtleWJvYXJkIEFQSXMgZG8gbm90IGhhdmUgY3Jvc3MtYnJvd3NlclxuICAgICAqIHN1cHBvcnQuIGBpb25LZXlib2FyZERpZFNob3dgIHJlbGllcyBvbiB0aGUgVmlzdWFsIFZpZXdwb3J0IEFQSS5cbiAgICAgKiBUaGlzIG1lYW5zIHRoYXQgaWYgdGhlIGtleWJvYXJkIGNoYW5nZXMgYnV0IGRvZXMgbm90IGNoYW5nZVxuICAgICAqIGdlb21ldHJ5LCB0aGVuIHNjcm9sbCBhc3Npc3Qgd2lsbCBub3QgcmUtcnVuIGV2ZW4gaWZcbiAgICAgKiB0aGUgdXNlciBoYXMgc2Nyb2xsZWQgdGhlIHRleHQgZmllbGQgdW5kZXIgdGhlIGtleWJvYXJkLlxuICAgICAqIFRoaXMgaXMgbm90IGEgcHJvYmxlbSB3aGVuIHJ1bm5pbmcgaW4gQ29yZG92YS9DYXBhY2l0b3JcbiAgICAgKiBiZWNhdXNlIGBpb25LZXlib2FyZERpZFNob3dgIHVzZXMgdGhlIG5hdGl2ZSBldmVudHNcbiAgICAgKiB3aGljaCBmaXJlIGV2ZXJ5IHRpbWUgdGhlIGtleWJvYXJkIGNoYW5nZXMuXG4gICAgICovXG4gICAgY29uc3Qga2V5Ym9hcmRTaG93ID0gKGV2KSA9PiB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJZiB0aGUga2V5Ym9hcmQgaGFzIG5vdCB5ZXQgYmVlbiBwcmVzZW50ZWRcbiAgICAgICAgICogZm9yIHRoaXMgdGV4dCBmaWVsZCB0aGVuIHRoZSB0ZXh0IGZpZWxkIGhhcyBqdXN0XG4gICAgICAgICAqIHJlY2VpdmVkIGZvY3VzLiBJbiB0aGF0IGNhc2UsIHRoZSBmb2N1c2luIGxpc3RlbmVyXG4gICAgICAgICAqIHdpbGwgcnVuIHNjcm9sbCBhc3Npc3QuXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoaGFzS2V5Ym9hcmRCZWVuUHJlc2VudGVkRm9yVGV4dEZpZWxkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgaGFzS2V5Ym9hcmRCZWVuUHJlc2VudGVkRm9yVGV4dEZpZWxkID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogT3RoZXJ3aXNlLCB0aGUga2V5Ym9hcmQgaGFzIGFscmVhZHkgYmVlbiBwcmVzZW50ZWRcbiAgICAgICAgICogZm9yIHRoZSBmb2N1c2VkIHRleHQgZmllbGQuXG4gICAgICAgICAqIFRoaXMgbWVhbnMgdGhhdCB0aGUga2V5Ym9hcmQgbGlrZWx5IGNoYW5nZWRcbiAgICAgICAgICogZ2VvbWV0cnksIGFuZCB3ZSBuZWVkIHRvIHJlLXJ1biBzY3JvbGwgYXNzaXN0LlxuICAgICAgICAgKiBUaGlzIGNhbiBoYXBwZW4gd2hlbiB0aGUgdXNlciByb3RhdGVzIHRoZWlyIGRldmljZVxuICAgICAgICAgKiBvciB3aGVuIHRoZXkgc3dpdGNoIGtleWJvYXJkcy5cbiAgICAgICAgICpcbiAgICAgICAgICogTWFrZSBzdXJlIHdlIHBhc3MgaW4gdGhlIGNvbXB1dGVkIGtleWJvYXJkIGhlaWdodFxuICAgICAgICAgKiByYXRoZXIgdGhhbiB0aGUgZXN0aW1hdGVkIGtleWJvYXJkIGhlaWdodC5cbiAgICAgICAgICpcbiAgICAgICAgICogU2luY2UgdGhlIGtleWJvYXJkIGlzIGFscmVhZHkgb3BlbiB0aGVuIHdlIGRvIG5vdFxuICAgICAgICAgKiBuZWVkIHRvIHdhaXQgZm9yIHRoZSB3ZWJ2aWV3IHRvIHJlc2l6ZSwgc28gd2UgcGFzc1xuICAgICAgICAgKiBcIndhaXRGb3JSZXNpemU6IGZhbHNlXCIuXG4gICAgICAgICAqL1xuICAgICAgICBqc1NldEZvY3VzKGNvbXBvbmVudEVsLCBpbnB1dEVsLCBjb250ZW50RWwsIGZvb3RlckVsLCBldi5kZXRhaWwua2V5Ym9hcmRIZWlnaHQsIGFkZFNjcm9sbFBhZGRpbmcsIGRpc2FibGVDbG9uZWRJbnB1dCwgcGxhdGZvcm1IZWlnaHQsIGZhbHNlKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFJlc2V0IHRoZSBpbnRlcm5hbCBzdGF0ZSB3aGVuIHRoZSB0ZXh0IGZpZWxkIGxvc2VzIGZvY3VzLlxuICAgICAqL1xuICAgIGNvbnN0IGZvY3VzT3V0ID0gKCkgPT4ge1xuICAgICAgICBoYXNLZXlib2FyZEJlZW5QcmVzZW50ZWRGb3JUZXh0RmllbGQgPSBmYWxzZTtcbiAgICAgICAgd2luID09PSBudWxsIHx8IHdpbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogd2luLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lvbktleWJvYXJkRGlkU2hvdycsIGtleWJvYXJkU2hvdyk7XG4gICAgICAgIGNvbXBvbmVudEVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3Vzb3V0JywgZm9jdXNPdXQsIHRydWUpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogV2hlbiB0aGUgaW5wdXQgaXMgYWJvdXQgdG8gcmVjZWl2ZVxuICAgICAqIGZvY3VzLCB3ZSBuZWVkIHRvIG1vdmUgaXQgdG8gcHJldmVudFxuICAgICAqIG1vYmlsZSBTYWZhcmkgZnJvbSBhZGp1c3RpbmcgdGhlIHZpZXdwb3J0LlxuICAgICAqL1xuICAgIGNvbnN0IGZvY3VzSW4gPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTY3JvbGwgYXNzaXN0IHNob3VsZCBub3QgcnVuIGFnYWluXG4gICAgICAgICAqIG9uIGlucHV0cyB0aGF0IGhhdmUgYmVlbiBtYW51YWxseVxuICAgICAgICAgKiBmb2N1c2VkIGluc2lkZSBvZiB0aGUgc2Nyb2xsIGFzc2lzdFxuICAgICAgICAgKiBpbXBsZW1lbnRhdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIGlmIChpbnB1dEVsLmhhc0F0dHJpYnV0ZShTS0lQX1NDUk9MTF9BU1NJU1QpKSB7XG4gICAgICAgICAgICBpbnB1dEVsLnJlbW92ZUF0dHJpYnV0ZShTS0lQX1NDUk9MTF9BU1NJU1QpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGpzU2V0Rm9jdXMoY29tcG9uZW50RWwsIGlucHV0RWwsIGNvbnRlbnRFbCwgZm9vdGVyRWwsIGtleWJvYXJkSGVpZ2h0LCBhZGRTY3JvbGxQYWRkaW5nLCBkaXNhYmxlQ2xvbmVkSW5wdXQsIHBsYXRmb3JtSGVpZ2h0KTtcbiAgICAgICAgd2luID09PSBudWxsIHx8IHdpbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogd2luLmFkZEV2ZW50TGlzdGVuZXIoJ2lvbktleWJvYXJkRGlkU2hvdycsIGtleWJvYXJkU2hvdyk7XG4gICAgICAgIGNvbXBvbmVudEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3Vzb3V0JywgZm9jdXNPdXQsIHRydWUpO1xuICAgIH07XG4gICAgY29tcG9uZW50RWwuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNpbicsIGZvY3VzSW4sIHRydWUpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGNvbXBvbmVudEVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzaW4nLCBmb2N1c0luLCB0cnVlKTtcbiAgICAgICAgd2luID09PSBudWxsIHx8IHdpbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogd2luLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lvbktleWJvYXJkRGlkU2hvdycsIGtleWJvYXJkU2hvdyk7XG4gICAgICAgIGNvbXBvbmVudEVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3Vzb3V0JywgZm9jdXNPdXQsIHRydWUpO1xuICAgIH07XG59O1xuLyoqXG4gKiBVc2UgdGhpcyBmdW5jdGlvbiB3aGVuIHlvdSB3YW50IHRvIG1hbnVhbGx5XG4gKiBmb2N1cyBhbiBpbnB1dCBidXQgbm90IGhhdmUgc2Nyb2xsIGFzc2lzdCBydW4gYWdhaW4uXG4gKi9cbmNvbnN0IHNldE1hbnVhbEZvY3VzID0gKGVsKSA9PiB7XG4gICAgLyoqXG4gICAgICogSWYgZWxlbWVudCBpcyBhbHJlYWR5IGZvY3VzZWQgdGhlblxuICAgICAqIGEgbmV3IGZvY3VzaW4gZXZlbnQgd2lsbCBub3QgYmUgZGlzcGF0Y2hlZFxuICAgICAqIHRvIHJlbW92ZSB0aGUgU0tJTF9TQ1JPTExfQVNTSVNUIGF0dHJpYnV0ZS5cbiAgICAgKi9cbiAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gZWwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlbC5zZXRBdHRyaWJ1dGUoU0tJUF9TQ1JPTExfQVNTSVNULCAndHJ1ZScpO1xuICAgIGVsLmZvY3VzKCk7XG59O1xuY29uc3QganNTZXRGb2N1cyA9IGFzeW5jIChjb21wb25lbnRFbCwgaW5wdXRFbCwgY29udGVudEVsLCBmb290ZXJFbCwga2V5Ym9hcmRIZWlnaHQsIGVuYWJsZVNjcm9sbFBhZGRpbmcsIGRpc2FibGVDbG9uZWRJbnB1dCA9IGZhbHNlLCBwbGF0Zm9ybUhlaWdodCA9IDAsIHdhaXRGb3JSZXNpemUgPSB0cnVlKSA9PiB7XG4gICAgaWYgKCFjb250ZW50RWwgJiYgIWZvb3RlckVsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgc2Nyb2xsRGF0YSA9IGdldFNjcm9sbERhdGEoY29tcG9uZW50RWwsIChjb250ZW50RWwgfHwgZm9vdGVyRWwpLCBrZXlib2FyZEhlaWdodCwgcGxhdGZvcm1IZWlnaHQpO1xuICAgIGlmIChjb250ZW50RWwgJiYgTWF0aC5hYnMoc2Nyb2xsRGF0YS5zY3JvbGxBbW91bnQpIDwgNCkge1xuICAgICAgICAvLyB0aGUgdGV4dCBpbnB1dCBpcyBpbiBhIHNhZmUgcG9zaXRpb24gdGhhdCBkb2Vzbid0XG4gICAgICAgIC8vIHJlcXVpcmUgaXQgdG8gYmUgc2Nyb2xsZWQgaW50byB2aWV3LCBqdXN0IHNldCBmb2N1cyBub3dcbiAgICAgICAgc2V0TWFudWFsRm9jdXMoaW5wdXRFbCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFdmVuIHRob3VnaCB0aGUgaW5wdXQgZG9lcyBub3QgbmVlZFxuICAgICAgICAgKiBzY3JvbGwgYXNzaXN0LCB3ZSBzaG91bGQgcHJlc2VydmUgdGhlXG4gICAgICAgICAqIHRoZSBzY3JvbGwgcGFkZGluZyBhcyB1c2VycyBjb3VsZCBiZSBtb3ZpbmdcbiAgICAgICAgICogZm9jdXMgZnJvbSBhbiBpbnB1dCB0aGF0IG5lZWRzIHNjcm9sbCBwYWRkaW5nXG4gICAgICAgICAqIHRvIGFuIGlucHV0IHRoYXQgZG9lcyBub3QgbmVlZCBzY3JvbGwgcGFkZGluZy5cbiAgICAgICAgICogSWYgd2UgcmVtb3ZlIHRoZSBzY3JvbGwgcGFkZGluZyBub3csIHVzZXJzIHdpbGxcbiAgICAgICAgICogc2VlIHRoZSBwYWdlIGp1bXAuXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoZW5hYmxlU2Nyb2xsUGFkZGluZyAmJiBjb250ZW50RWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHNldFNjcm9sbFBhZGRpbmcoY29udGVudEVsLCBjdXJyZW50UGFkZGluZyk7XG4gICAgICAgICAgICBzZXRDbGVhclNjcm9sbFBhZGRpbmdMaXN0ZW5lcihpbnB1dEVsLCBjb250ZW50RWwsICgpID0+IChjdXJyZW50UGFkZGluZyA9IDApKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIHRlbXBvcmFyaWx5IG1vdmUgdGhlIGZvY3VzIHRvIHRoZSBmb2N1cyBob2xkZXIgc28gdGhlIGJyb3dzZXJcbiAgICAvLyBkb2Vzbid0IGZyZWFrIG91dCB3aGlsZSBpdCdzIHRyeWluZyB0byBnZXQgdGhlIGlucHV0IGluIHBsYWNlXG4gICAgLy8gYXQgdGhpcyBwb2ludCB0aGUgbmF0aXZlIHRleHQgaW5wdXQgc3RpbGwgZG9lcyBub3QgaGF2ZSBmb2N1c1xuICAgIHJlbG9jYXRlSW5wdXQoY29tcG9uZW50RWwsIGlucHV0RWwsIHRydWUsIHNjcm9sbERhdGEuaW5wdXRTYWZlWSwgZGlzYWJsZUNsb25lZElucHV0KTtcbiAgICBzZXRNYW51YWxGb2N1cyhpbnB1dEVsKTtcbiAgICAvKipcbiAgICAgKiBSZWxvY2F0aW5nL0ZvY3VzaW5nIGlucHV0IGNhdXNlcyB0aGVcbiAgICAgKiBjbGljayBldmVudCB0byBiZSBjYW5jZWxsZWQsIHNvXG4gICAgICogbWFudWFsbHkgZmlyZSBvbmUgaGVyZS5cbiAgICAgKi9cbiAgICByYWYoKCkgPT4gY29tcG9uZW50RWwuY2xpY2soKSk7XG4gICAgLyoqXG4gICAgICogSWYgZW5hYmxlZCwgd2UgY2FuIGFkZCBzY3JvbGwgcGFkZGluZyB0b1xuICAgICAqIHRoZSBib3R0b20gb2YgdGhlIGNvbnRlbnQgc28gdGhhdCBzY3JvbGwgYXNzaXN0XG4gICAgICogaGFzIGVub3VnaCByb29tIHRvIHNjcm9sbCB0aGUgaW5wdXQgYWJvdmVcbiAgICAgKiB0aGUga2V5Ym9hcmQuXG4gICAgICovXG4gICAgaWYgKGVuYWJsZVNjcm9sbFBhZGRpbmcgJiYgY29udGVudEVsKSB7XG4gICAgICAgIGN1cnJlbnRQYWRkaW5nID0gc2Nyb2xsRGF0YS5zY3JvbGxQYWRkaW5nO1xuICAgICAgICBzZXRTY3JvbGxQYWRkaW5nKGNvbnRlbnRFbCwgY3VycmVudFBhZGRpbmcpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgbGV0IHNjcm9sbENvbnRlbnRUaW1lb3V0O1xuICAgICAgICBjb25zdCBzY3JvbGxDb250ZW50ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gY2xlYW4gdXAgbGlzdGVuZXJzIGFuZCB0aW1lb3V0c1xuICAgICAgICAgICAgaWYgKHNjcm9sbENvbnRlbnRUaW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoc2Nyb2xsQ29udGVudFRpbWVvdXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lvbktleWJvYXJkRGlkU2hvdycsIGRvdWJsZUtleWJvYXJkRXZlbnRMaXN0ZW5lcik7XG4gICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignaW9uS2V5Ym9hcmREaWRTaG93Jywgc2Nyb2xsQ29udGVudCk7XG4gICAgICAgICAgICAvLyBzY3JvbGwgdGhlIGlucHV0IGludG8gcGxhY2VcbiAgICAgICAgICAgIGlmIChjb250ZW50RWwpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzY3JvbGxCeVBvaW50KGNvbnRlbnRFbCwgMCwgc2Nyb2xsRGF0YS5zY3JvbGxBbW91bnQsIHNjcm9sbERhdGEuc2Nyb2xsRHVyYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gdGhlIHNjcm9sbCB2aWV3IGlzIGluIHRoZSBjb3JyZWN0IHBvc2l0aW9uIG5vd1xuICAgICAgICAgICAgLy8gZ2l2ZSB0aGUgbmF0aXZlIHRleHQgaW5wdXQgZm9jdXNcbiAgICAgICAgICAgIHJlbG9jYXRlSW5wdXQoY29tcG9uZW50RWwsIGlucHV0RWwsIGZhbHNlLCBzY3JvbGxEYXRhLmlucHV0U2FmZVkpO1xuICAgICAgICAgICAgLy8gZW5zdXJlIHRoaXMgaXMgdGhlIGZvY3VzZWQgaW5wdXRcbiAgICAgICAgICAgIHNldE1hbnVhbEZvY3VzKGlucHV0RWwpO1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBXaGVuIHRoZSBpbnB1dCBpcyBhYm91dCB0byBiZSBibHVycmVkXG4gICAgICAgICAgICAgKiB3ZSBzaG91bGQgc2V0IGEgdGltZW91dCB0byByZW1vdmVcbiAgICAgICAgICAgICAqIGFueSBzY3JvbGwgcGFkZGluZy5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYgKGVuYWJsZVNjcm9sbFBhZGRpbmcpIHtcbiAgICAgICAgICAgICAgICBzZXRDbGVhclNjcm9sbFBhZGRpbmdMaXN0ZW5lcihpbnB1dEVsLCBjb250ZW50RWwsICgpID0+IChjdXJyZW50UGFkZGluZyA9IDApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZG91YmxlS2V5Ym9hcmRFdmVudExpc3RlbmVyID0gKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lvbktleWJvYXJkRGlkU2hvdycsIGRvdWJsZUtleWJvYXJkRXZlbnRMaXN0ZW5lcik7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignaW9uS2V5Ym9hcmREaWRTaG93Jywgc2Nyb2xsQ29udGVudCk7XG4gICAgICAgIH07XG4gICAgICAgIGlmIChjb250ZW50RWwpIHtcbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbEVsID0gYXdhaXQgZ2V0U2Nyb2xsRWxlbWVudChjb250ZW50RWwpO1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBzY3JvbGxEYXRhIHdpbGwgb25seSBjb25zaWRlciB0aGUgYW1vdW50IHdlIG5lZWRcbiAgICAgICAgICAgICAqIHRvIHNjcm9sbCBpbiBvcmRlciB0byBwcm9wZXJseSBicmluZyB0aGUgaW5wdXRcbiAgICAgICAgICAgICAqIGludG8gdmlldy4gSXQgd2lsbCBub3QgY29uc2lkZXIgdGhlIGFtb3VudFxuICAgICAgICAgICAgICogd2UgY2FuIHNjcm9sbCBpbiB0aGUgY29udGVudCBlbGVtZW50LlxuICAgICAgICAgICAgICogQXMgYSByZXN1bHQsIHNjcm9sbERhdGEgbWF5IHJlcXVlc3QgYSBncmVhdGVyXG4gICAgICAgICAgICAgKiBzY3JvbGwgcG9zaXRpb24gdGhhbiBpcyBjdXJyZW50bHkgYXZhaWxhYmxlXG4gICAgICAgICAgICAgKiBpbiB0aGUgRE9NLiBJZiB0aGlzIGlzIHRoZSBjYXNlLCB3ZSBuZWVkIHRvXG4gICAgICAgICAgICAgKiB3YWl0IGZvciB0aGUgd2VidmlldyB0byByZXNpemUvdGhlIGtleWJvYXJkXG4gICAgICAgICAgICAgKiB0byBzaG93IGluIG9yZGVyIGZvciBhZGRpdGlvbmFsIHNjcm9sbFxuICAgICAgICAgICAgICogYmFuZHdpZHRoIHRvIGJlY29tZSBhdmFpbGFibGUuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGNvbnN0IHRvdGFsU2Nyb2xsQW1vdW50ID0gc2Nyb2xsRWwuc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsRWwuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgaWYgKHdhaXRGb3JSZXNpemUgJiYgc2Nyb2xsRGF0YS5zY3JvbGxBbW91bnQgPiB0b3RhbFNjcm9sbEFtb3VudCAtIHNjcm9sbEVsLnNjcm9sbFRvcCkge1xuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIE9uIGlPUyBkZXZpY2VzLCB0aGUgc3lzdGVtIHdpbGwgc2hvdyBhIFwiUGFzc3dvcmRzXCIgYmFyIGFib3ZlIHRoZSBrZXlib2FyZFxuICAgICAgICAgICAgICAgICAqIGFmdGVyIHRoZSBpbml0aWFsIGtleWJvYXJkIGlzIHNob3duLiBUaGlzIHByZXZlbnRzIHRoZSB3ZWJ2aWV3IGZyb20gcmVzaXppbmdcbiAgICAgICAgICAgICAgICAgKiB1bnRpbCB0aGUgXCJQYXNzd29yZHNcIiBiYXIgaXMgc2hvd24sIHNvIHdlIG5lZWQgdG8gd2FpdCBmb3IgdGhhdCB0byBoYXBwZW4gZmlyc3QuXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgaWYgKGlucHV0RWwudHlwZSA9PT0gJ3Bhc3N3b3JkJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgNTBweCB0byBhY2NvdW50IGZvciB0aGUgXCJQYXNzd29yZHNcIiBiYXJcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsRGF0YS5zY3JvbGxBbW91bnQgKz0gU0NST0xMX0FNT1VOVF9QQURESU5HO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignaW9uS2V5Ym9hcmREaWRTaG93JywgZG91YmxlS2V5Ym9hcmRFdmVudExpc3RlbmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdpb25LZXlib2FyZERpZFNob3cnLCBzY3JvbGxDb250ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogVGhpcyBzaG91bGQgb25seSBmaXJlIGluIDIgaW5zdGFuY2VzOlxuICAgICAgICAgICAgICAgICAqIDEuIFRoZSBhcHAgaXMgdmVyeSBzbG93LlxuICAgICAgICAgICAgICAgICAqIDIuIFRoZSBhcHAgaXMgcnVubmluZyBpbiBhIGJyb3dzZXIgb24gYW4gb2xkIE9TXG4gICAgICAgICAgICAgICAgICogdGhhdCBkb2VzIG5vdCBzdXBwb3J0IElvbmljIEtleWJvYXJkIEV2ZW50c1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHNjcm9sbENvbnRlbnRUaW1lb3V0ID0gc2V0VGltZW91dChzY3JvbGxDb250ZW50LCAxMDAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2Nyb2xsQ29udGVudCgpO1xuICAgIH1cbn07XG5cbmNvbnN0IElOUFVUX0JMVVJSSU5HID0gdHJ1ZTtcbmNvbnN0IHN0YXJ0SW5wdXRTaGltcyA9IGFzeW5jIChjb25maWcsIHBsYXRmb3JtKSA9PiB7XG4gICAgLyoqXG4gICAgICogSWYgZG9jIGlzIHVuZGVmaW5lZCB0aGVuIHdlIGFyZSBpbiBhbiBTU1IgZW52aXJvbm1lbnRcbiAgICAgKiB3aGVyZSBpbnB1dCBzaGltcyBkbyBub3QgYXBwbHkuXG4gICAgICovXG4gICAgaWYgKGRvYyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaXNJT1MgPSBwbGF0Zm9ybSA9PT0gJ2lvcyc7XG4gICAgY29uc3QgaXNBbmRyb2lkID0gcGxhdGZvcm0gPT09ICdhbmRyb2lkJztcbiAgICAvKipcbiAgICAgKiBIaWRlIENhcmV0IGFuZCBJbnB1dCBCbHVycmluZyBhcmUgbmVlZGVkIG9uIGlPUy5cbiAgICAgKiBTY3JvbGwgQXNzaXN0IGFuZCBTY3JvbGwgUGFkZGluZyBhcmUgbmVlZGVkIG9uIGlPUyBhbmQgQW5kcm9pZFxuICAgICAqIHdpdGggQ2hyb21lIHdlYiBicm93c2VyIChub3QgQ2hyb21lIHdlYnZpZXcpLlxuICAgICAqL1xuICAgIGNvbnN0IGtleWJvYXJkSGVpZ2h0ID0gY29uZmlnLmdldE51bWJlcigna2V5Ym9hcmRIZWlnaHQnLCAyOTApO1xuICAgIGNvbnN0IHNjcm9sbEFzc2lzdCA9IGNvbmZpZy5nZXRCb29sZWFuKCdzY3JvbGxBc3Npc3QnLCB0cnVlKTtcbiAgICBjb25zdCBoaWRlQ2FyZXQgPSBjb25maWcuZ2V0Qm9vbGVhbignaGlkZUNhcmV0T25TY3JvbGwnLCBpc0lPUyk7XG4gICAgY29uc3QgaW5wdXRCbHVycmluZyA9IGNvbmZpZy5nZXRCb29sZWFuKCdpbnB1dEJsdXJyaW5nJywgaXNJT1MpO1xuICAgIGNvbnN0IHNjcm9sbFBhZGRpbmcgPSBjb25maWcuZ2V0Qm9vbGVhbignc2Nyb2xsUGFkZGluZycsIHRydWUpO1xuICAgIGNvbnN0IGlucHV0cyA9IEFycmF5LmZyb20oZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lvbi1pbnB1dCwgaW9uLXRleHRhcmVhJykpO1xuICAgIGNvbnN0IGhpZGVDYXJldE1hcCA9IG5ldyBXZWFrTWFwKCk7XG4gICAgY29uc3Qgc2Nyb2xsQXNzaXN0TWFwID0gbmV3IFdlYWtNYXAoKTtcbiAgICAvKipcbiAgICAgKiBHcmFiIHRoZSBuYXRpdmUga2V5Ym9hcmQgcmVzaXplIGNvbmZpZ3VyYXRpb25cbiAgICAgKiBhbmQgcGFzcyBpdCB0byBzY3JvbGwgYXNzaXN0LiBTY3JvbGwgYXNzaXN0IHJlcXVpcmVzXG4gICAgICogdGhhdCB3ZSBhZGp1c3QgdGhlIGlucHV0IHJpZ2h0IGJlZm9yZSB0aGUgaW5wdXRcbiAgICAgKiBpcyBhYm91dCB0byBiZSBmb2N1c2VkLiBJZiB3ZSBjYWxsZWQgYEtleWJvYXJkLmdldFJlc2l6ZU1vZGVgXG4gICAgICogb24gZm9jdXNpbiBpbiBzY3JvbGwgYXNzaXN0LCB3ZSBjb3VsZCBwb3RlbnRpYWxseSBhZGp1c3QgdGhlXG4gICAgICogaW5wdXQgdG9vIGxhdGUgc2luY2UgdGhpcyBjYWxsIGlzIGFzeW5jLlxuICAgICAqL1xuICAgIGNvbnN0IGtleWJvYXJkUmVzaXplTW9kZSA9IGF3YWl0IEtleWJvYXJkLmdldFJlc2l6ZU1vZGUoKTtcbiAgICBjb25zdCByZWdpc3RlcklucHV0ID0gYXN5bmMgKGNvbXBvbmVudEVsKSA9PiB7XG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBjb21wb25lbnRPblJlYWR5KGNvbXBvbmVudEVsLCByZXNvbHZlKSk7XG4gICAgICAgIGNvbnN0IGlucHV0Um9vdCA9IGNvbXBvbmVudEVsLnNoYWRvd1Jvb3QgfHwgY29tcG9uZW50RWw7XG4gICAgICAgIGNvbnN0IGlucHV0RWwgPSBpbnB1dFJvb3QucXVlcnlTZWxlY3RvcignaW5wdXQnKSB8fCBpbnB1dFJvb3QucXVlcnlTZWxlY3RvcigndGV4dGFyZWEnKTtcbiAgICAgICAgY29uc3Qgc2Nyb2xsRWwgPSBmaW5kQ2xvc2VzdElvbkNvbnRlbnQoY29tcG9uZW50RWwpO1xuICAgICAgICBjb25zdCBmb290ZXJFbCA9ICFzY3JvbGxFbCA/IGNvbXBvbmVudEVsLmNsb3Nlc3QoJ2lvbi1mb290ZXInKSA6IG51bGw7XG4gICAgICAgIGlmICghaW5wdXRFbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghIXNjcm9sbEVsICYmIGhpZGVDYXJldCAmJiAhaGlkZUNhcmV0TWFwLmhhcyhjb21wb25lbnRFbCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHJtRm4gPSBlbmFibGVIaWRlQ2FyZXRPblNjcm9sbChjb21wb25lbnRFbCwgaW5wdXRFbCwgc2Nyb2xsRWwpO1xuICAgICAgICAgICAgaGlkZUNhcmV0TWFwLnNldChjb21wb25lbnRFbCwgcm1Gbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGRhdGUvZGF0ZXRpbWUtbG9jYWxlIGlucHV0cyBvbiBtb2JpbGUgZGV2aWNlcyBzaG93IGRhdGUgcGlja2VyXG4gICAgICAgICAqIG92ZXJsYXlzIGluc3RlYWQgb2Yga2V5Ym9hcmRzLiBBcyBhIHJlc3VsdCwgc2Nyb2xsIGFzc2lzdCBpc1xuICAgICAgICAgKiBub3QgbmVlZGVkLiBUaGlzIGFsc28gd29ya3MgYXJvdW5kIGEgYnVnIGluIGlPUyA8MTYgd2hlcmVcbiAgICAgICAgICogc2Nyb2xsIGFzc2lzdCBjYXVzZXMgdGhlIGJyb3dzZXIgdG8gbG9jayB1cC4gU2VlIEZXLTE5OTcuXG4gICAgICAgICAqL1xuICAgICAgICBjb25zdCBpc0RhdGVJbnB1dCA9IGlucHV0RWwudHlwZSA9PT0gJ2RhdGUnIHx8IGlucHV0RWwudHlwZSA9PT0gJ2RhdGV0aW1lLWxvY2FsJztcbiAgICAgICAgaWYgKCFpc0RhdGVJbnB1dCAmJlxuICAgICAgICAgICAgKCEhc2Nyb2xsRWwgfHwgISFmb290ZXJFbCkgJiZcbiAgICAgICAgICAgIHNjcm9sbEFzc2lzdCAmJlxuICAgICAgICAgICAgIXNjcm9sbEFzc2lzdE1hcC5oYXMoY29tcG9uZW50RWwpKSB7XG4gICAgICAgICAgICBjb25zdCBybUZuID0gZW5hYmxlU2Nyb2xsQXNzaXN0KGNvbXBvbmVudEVsLCBpbnB1dEVsLCBzY3JvbGxFbCwgZm9vdGVyRWwsIGtleWJvYXJkSGVpZ2h0LCBzY3JvbGxQYWRkaW5nLCBrZXlib2FyZFJlc2l6ZU1vZGUsIGlzQW5kcm9pZCk7XG4gICAgICAgICAgICBzY3JvbGxBc3Npc3RNYXAuc2V0KGNvbXBvbmVudEVsLCBybUZuKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgdW5yZWdpc3RlcklucHV0ID0gKGNvbXBvbmVudEVsKSA9PiB7XG4gICAgICAgIGlmIChoaWRlQ2FyZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZuID0gaGlkZUNhcmV0TWFwLmdldChjb21wb25lbnRFbCk7XG4gICAgICAgICAgICBpZiAoZm4pIHtcbiAgICAgICAgICAgICAgICBmbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaGlkZUNhcmV0TWFwLmRlbGV0ZShjb21wb25lbnRFbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNjcm9sbEFzc2lzdCkge1xuICAgICAgICAgICAgY29uc3QgZm4gPSBzY3JvbGxBc3Npc3RNYXAuZ2V0KGNvbXBvbmVudEVsKTtcbiAgICAgICAgICAgIGlmIChmbikge1xuICAgICAgICAgICAgICAgIGZuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzY3JvbGxBc3Npc3RNYXAuZGVsZXRlKGNvbXBvbmVudEVsKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgaWYgKGlucHV0Qmx1cnJpbmcgJiYgSU5QVVRfQkxVUlJJTkcpIHtcbiAgICAgICAgZW5hYmxlSW5wdXRCbHVycmluZygpO1xuICAgIH1cbiAgICAvLyBJbnB1dCBtaWdodCBiZSBhbHJlYWR5IGxvYWRlZCBpbiB0aGUgRE9NIGJlZm9yZSBpb24tZGV2aWNlLWhhY2tzIGRpZC5cbiAgICAvLyBBdCB0aGlzIHBvaW50IHdlIG5lZWQgdG8gbG9vayBmb3IgYWxsIG9mIHRoZSBpbnB1dHMgbm90IHJlZ2lzdGVyZWQgeWV0XG4gICAgLy8gYW5kIHJlZ2lzdGVyIHRoZW0uXG4gICAgZm9yIChjb25zdCBpbnB1dCBvZiBpbnB1dHMpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnB1dChpbnB1dCk7XG4gICAgfVxuICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKCdpb25JbnB1dERpZExvYWQnLCAoZXYpID0+IHtcbiAgICAgICAgcmVnaXN0ZXJJbnB1dChldi5kZXRhaWwpO1xuICAgIH0pO1xuICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKCdpb25JbnB1dERpZFVubG9hZCcsIChldikgPT4ge1xuICAgICAgICB1bnJlZ2lzdGVySW5wdXQoZXYuZGV0YWlsKTtcbiAgICB9KTtcbn07XG5cbmV4cG9ydCB7IHN0YXJ0SW5wdXRTaGltcyB9O1xuIl0sIm5hbWVzIjpbImNsb25lTWFwIiwiV2Vha01hcCIsInJlbG9jYXRlSW5wdXQiLCJjb21wb25lbnRFbCIsImlucHV0RWwiLCJzaG91bGRSZWxvY2F0ZSIsImlucHV0UmVsYXRpdmVZIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiZGlzYWJsZWRDbG9uZWRJbnB1dCIsImhhcyIsImFkZENsb25lIiwicmVtb3ZlQ2xvbmUiLCJwYXJlbnRFbCIsInBhcmVudE5vZGUiLCJjbG9uZWRFbCIsImNsb25lTm9kZSIsImNsYXNzTGlzdCIsImFkZCIsInRhYkluZGV4IiwiZGlzYWJsZWQiLCJhcHBlbmRDaGlsZCIsInNldCIsInR4Iiwib3duZXJEb2N1bWVudCIsImRpciIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsInRyYW5zZm9ybSIsImNsb25lIiwiZ2V0IiwiZGVsZXRlIiwicmVtb3ZlIiwiU0tJUF9TRUxFQ1RPUiIsImNhbGNTY3JvbGxEYXRhIiwiaW5wdXRSZWN0IiwiY29udGVudFJlY3QiLCJrZXlib2FyZEhlaWdodCIsInBsYXRmb3JtSGVpZ2h0IiwiaW5wdXRUb3AiLCJ0b3AiLCJpbnB1dEJvdHRvbSIsImJvdHRvbSIsInZpc2libGVBcmVhVG9wIiwic2FmZUFyZWFUb3AiLCJkaXN0YW5jZVRvQm90dG9tIiwiTWF0aCIsIm1pbiIsImRpc3RhbmNlVG9Ub3AiLCJkZXNpcmVkU2Nyb2xsQW1vdW50Iiwicm91bmQiLCJzY3JvbGxBbW91bnQiLCJkdXJhdGlvbiIsImFicyIsInNjcm9sbER1cmF0aW9uIiwibWF4Iiwic2Nyb2xsUGFkZGluZyIsImlucHV0U2FmZVkiLCJQQURESU5HX1RJTUVSX0tFWSIsInNldFNjcm9sbFBhZGRpbmciLCJjb250ZW50RWwiLCJwYWRkaW5nQW1vdW50IiwiY2xlYXJDYWxsYmFjayIsInRpbWVyIiwiY2xlYXJUaW1lb3V0Iiwic2V0UHJvcGVydHkiLCJzZXRUaW1lb3V0Iiwic2V0Q2xlYXJTY3JvbGxQYWRkaW5nTGlzdGVuZXIiLCJkb25lQ2FsbGJhY2siLCJhZGRFdmVudExpc3RlbmVyIiwiY2xlYXJTY3JvbGxQYWRkaW5nIiwib25jZSIsImN1cnJlbnRQYWRkaW5nIiwiU0tJUF9TQ1JPTExfQVNTSVNUIiwic2V0TWFudWFsRm9jdXMiLCJlbCIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImZvY3VzIiwianNTZXRGb2N1cyIsImFzeW5jIiwiZm9vdGVyRWwiLCJlbmFibGVTY3JvbGxQYWRkaW5nIiwiZGlzYWJsZUNsb25lZElucHV0Iiwid2FpdEZvclJlc2l6ZSIsInNjcm9sbERhdGEiLCJnZXRTY3JvbGxEYXRhIiwiX2EiLCJpdGVtRWwiLCJjbG9zZXN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwicmFmIiwiY2xpY2siLCJ3aW5kb3ciLCJzY3JvbGxDb250ZW50VGltZW91dCIsInNjcm9sbENvbnRlbnQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZG91YmxlS2V5Ym9hcmRFdmVudExpc3RlbmVyIiwic2Nyb2xsQnlQb2ludCIsInNjcm9sbEVsIiwiZ2V0U2Nyb2xsRWxlbWVudCIsInRvdGFsU2Nyb2xsQW1vdW50Iiwic2Nyb2xsSGVpZ2h0IiwiY2xpZW50SGVpZ2h0Iiwic2Nyb2xsVG9wIiwidHlwZSIsInN0YXJ0SW5wdXRTaGltcyIsImNvbmZpZyIsInBsYXRmb3JtIiwiZG9jIiwiaXNJT1MiLCJpc0FuZHJvaWQiLCJnZXROdW1iZXIiLCJzY3JvbGxBc3Npc3QiLCJnZXRCb29sZWFuIiwiaGlkZUNhcmV0IiwiaW5wdXRCbHVycmluZyIsImlucHV0cyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJoaWRlQ2FyZXRNYXAiLCJzY3JvbGxBc3Npc3RNYXAiLCJrZXlib2FyZFJlc2l6ZU1vZGUiLCJLZXlib2FyZCIsImdldFJlc2l6ZU1vZGUiLCJyZWdpc3RlcklucHV0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJjb21wb25lbnRPblJlYWR5IiwiaW5wdXRSb290Iiwic2hhZG93Um9vdCIsInF1ZXJ5U2VsZWN0b3IiLCJmaW5kQ2xvc2VzdElvbkNvbnRlbnQiLCJybUZuIiwiZW5hYmxlSGlkZUNhcmV0T25TY3JvbGwiLCJzY3JvbGxIaWRlQ2FyZXQiLCJzaG91bGRIaWRlQ2FyZXQiLCJpbnB1dCIsImdldFJvb3ROb2RlIiwib25CbHVyIiwic2hvd0NhcmV0Iiwia2V5Ym9hcmRSZXNpemUiLCJhZGRTY3JvbGxQYWRkaW5nIiwibW9kZSIsIktleWJvYXJkUmVzaXplIiwiTm9uZSIsImhhc0tleWJvYXJkQmVlblByZXNlbnRlZEZvclRleHRGaWVsZCIsIndpbiIsImlubmVySGVpZ2h0Iiwia2V5Ym9hcmRTaG93IiwiZXYiLCJkZXRhaWwiLCJmb2N1c091dCIsImZvY3VzSW4iLCJoYXNBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJlbmFibGVTY3JvbGxBc3Npc3QiLCJlbmFibGVJbnB1dEJsdXJyaW5nIiwiZm9jdXNlZCIsImRpZFNjcm9sbCIsIm9uU2Nyb2xsIiwib25Gb2N1c2luIiwib25Ub3VjaGVuZCIsImFjdGl2ZSIsIm1hdGNoZXMiLCJ0YXBwZWQiLCJ0YXJnZXQiLCJibHVyIiwiZm4iLCJ1bnJlZ2lzdGVySW5wdXQiXSwic291cmNlUm9vdCI6IiJ9